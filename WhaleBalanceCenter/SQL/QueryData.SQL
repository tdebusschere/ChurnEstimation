select             a.[type],
                   a.website, 
                   a.memberid,
                   a.activity, 
                   leave7d0, 
                   leave7d1, 
                   leave7d3, 
                   leave7d5, 
                   leave7d7, 
                   leave7d14 , 
                   dayssincelasttime days_since_last_activity,
                   memberlevelsettingid,
                   wagerscount,
                   amountsum ,
                   payoffsum,
                   commissionablesum ,
                   hoursplayed,
                   diffgamesplayed,
                   lastperiodplayed,
                   lastrawdatatype,
                   lastcode,
                   mostrawdatatype,
                   mostcode,
                   betamountrawdatatype, 
                   betamountcode, 
                   wagerscountrawdatatype, 
                   wagerscountcode,
                   wh.walletamount,
                   datediff(D,us.jointime,a.activity)+1 jointime,
				   datediff(D,us.Firstdayplayed,a.activity) first_day_played,
                   logintimes,
                   logindays,
                   time_since_last_time, 
                   time_before,
                   time_between,
                   deposittimes,
                   creditdeposittimes,
                   thirdpartypaymenttimes,
                   depositsum,
                   creditdepositsum,
                   thirdpartypaymentsum,
                   depositmax,
                   withdrawtimes,
                   withdrawsum,
                   withdrawmax,
                   favorablesum,
                   discountsum,
                   otherssum ,
                   MemberDiscountsum,
                   last_deposit,
                   previous_deposit,
                   previous_depositamt,
                   previous_depositlag,
                   datesdeposited,
                   avg_time_between_deposit,
                   avg_depositamt,
                   avg_deposittimes,
                   Last_depositamt,
                   last_withdraw ,
                   last_withdrawamt,
                   previous_withdraw,
                   previous_withdrawamt,
                   previous_withdrawlag, 
                   dateswithdraw,
                   avg_time_between_withdraw,
                   avg_withdrawamt,
                   avg_withdrawtimes,
                   yesterday_deposit,
                   yesterday_depositamt,
                   yesterday_withdraw,
                   yesterday_withdrawamt,
                   last_7d_deposit,
                   last_7d_depositamt,
                   last_7d_withdraw,
                   last_7d_withdraw_amt,
                   timesincelastdeposit,
                   timesincelastwithdraw,
                   case when  dateswithdraw > 0 then 1 else 0 end did_withdraw,
                   absent3days,
                   absent7days,
                   biggestdiff, 
                   absent3dayslastmonth,
                   absent7dayslastmonth,
                   biggestdifflastmonth,
                   interval,
                   leavedate,
                   payoff7d,
                   wagerscount1d
                   wagerscount7d,
                   payoff1d, 
                   wagerscount1d,
                   datepart(dw,a.activity) dow, 
                   datepart(dd, a.activity) dom,
                   d14today, 
                   d15today, 
                   d24today, 
                   d25today, 
                   d14_0, 
                   d14_1, 
                   d14_3, 
                   d14_5, 
                   d14_7, 
                   d14_14, 
                   d15_0, 
                   d15_1, 
                   d15_3, 
                   d15_5, 
                   d15_7, 
                   d15_14,
                   d24_0, 
                   d24_1,
                   d24_3, 
                   d24_5, 
                   d24_7, 
                   d24_14, 
                   d25_0, 
                   d25_1, 
                   d25_3, 
                   d25_5, 
                   d25_7, 
                   d25_14, 
                   leaveday, 
                   walletamt1d,
                   walletamt2d, 
                   walletamt3d, 
                   walletamt4d, 
                   walletamt5d, 
                   walletamt6d, 
                   walletamt7d, 
                   d30orbiggerleave7d0, 
                   d30orbiggerleave7d1,
                   d30orbiggerleave7d3, 
                   d30orbiggerleave7d5, 
                   d30orbiggerleave7d7, 
                   d30orbiggerleave7d14, 
                   m1leave7d0, 
                   m1leave7d1, 
                   m1leave7d3,
                   m1leave7d5, 
                   m1leave7d7, 
                   m1leave7d14, 
                   amountsum7d, 
                   logindays7d, 
                   avg_depositamount_decreasing,
                   avg_deposittimes_decreasing, 
                   avg_withdrawamount_increasing, 
                   avg_depositamt_over_1000,
                   discount
                   from  [Datascientist].[dbo].[RetentionListActivity] a 
                   left join  [Datascientist].dbo.RetentionListBetrecord  b
                   on a.MemberId = b.memberid and a.activity = b.activity  and a.[type] = b.type and a.website = b.website
                   left join  [Datascientist].dbo.RetentionListIP i 
                   on i.memberid = a.MemberId and a.activity = i.activity and a.website = i.website and a.type = i.type
                   left join  [Datascientist].dbo.RetentionListFinancialHistory f
                   on f.memberid = a.MemberId and a.activity = f.activity and a.website = f.website and a.type = f.type
				   left join  [Datascientist].dbo.RetentionListFinancialLastMonth lm
                   on lm.memberid = a.MemberId and a.activity = lm.activity and a.website = lm.website and a.type = lm.type
                   left join  [Datascientist].dbo.RetentionListWalletHistory  wh 
                   on a.MemberId = wh.memberid and a.activity = wh.activity and a.website = wh.website and a.type = wh.type
				   left join  [Datascientist].dbo.RetentionListActivityDates d 
                   on d.memberid = a.MemberId and d.activity = a.activity and a.website = d.website and a.type = d.type
                   left join  [Datascientist].dbo.RetentionListFinancialPromotion fp 
                   on a.MemberId = fp.memberid and a.activity = fp.activity and a.website = fp.website and a.type = fp.type
				   left join [Datascientist].dbo.RetentionListActivityHistory h 
                   on h.memberid = a.MemberId and h.activity = a.activity and a.type = h.type and a.website = h.website 
				   left join 
				   (select min(jointime) jointime,
						   min(firstdayplayed) firstdayplayed,
						   Max(memberlevelsettingid) Memberlevelsettingid,
						   memberid,
						   [type] from [Datascientist].[dbo].[RetentionListUsers] 
				   group by memberid,[type])us
				   on a.MemberId = us.memberid and a.[type] = us.[type]
                   where a.website = 'DQ002' and 
						 a.included = 1 and 
						 hoursplayed > 0 and 
						 datediff(D,us.jointime,a.activity) >=30 and 
						 datediff(D,us.Firstdayplayed,a.activity) >=30  and 
						 a.activity >= '2019-12-07' AND
						 a.[Type] in ('Dolphin','Whale')
                   order by a.memberid, a.activity
